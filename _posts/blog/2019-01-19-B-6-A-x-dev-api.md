---
title: MySQL 8.0 - Performance_schema events_statements_histogram_by_digest Table
author: min_cho
created: 2019/01/19
modified:
layout: post
tags: mysql mysql8 performance_schema
image:
  feature: mysql.png
categories: MySQL8
toc: true
toc_label: "My Table of Contents"
toc_icon: "cog"
---


------
## 개요

![x-dev](/Users/kakaobank/Downloads/x-dev.jpeg)

- Web Application 개발에 있어, FRONT가 중요한 역할을 하며, JSON과 같은 비정형 데이터를 저장해야 하는 요구사항이 많아지게 되었다. 이에따라, Mongo DB 와 같은 Document Store Database 가 많은 유행을 하게 되었고 지금까지 사용되어져 왔다.

- MySQL에 Document Store기능이 내장됨으로써 더 이상 JSON type의 데이터 처리를 위해서 MongoDB와 같은 Document NoSQL Database 사용 및 운영에 대한 고민을 할 필요가 없게 되었다.

- MySQL 은 이러한 흐름에 맞추어 Document를 저장할 수 있는 [JSON Data type](https://wiki.kabang.io/display/KAKAOBANK/JSON+Data+Type) 을 지원 (MySQL 5.7) 하게 되었고, 이를 이용하여 MySQL 8.0에 새로 소개된[ X DEV API](https://dev.mysql.com/doc/x-devapi-userguide/en/) 를 통해 MongoDB 와 같은 Document Store Database사용 및 운영에 대한 고민을 할 필요가 없어졌고, DATA 자체는

  - Undo image 및 Transaction 지원으로, 백업 / 복구가 현재까지 사용되던 방식 그대로 사용될 수 있다.
  - 현재 개발되어 사용되던 RDBMS 방식 그대로 사용될 수 있으며, JSON 을 저장하는 Document Store를 추가로 이용할 수 있다.
  - JSON 데이터를 저장하고 있는 Document Store와 일반 InnoDB Table간의 조인을 포함하여 여러가지 연산을 실행해낼 수 있다.



- 저장된 JSON 문서에 접근하기 위한 Document-Store API방식을 X DEV API로 제공하여, SQL보다는 API방식으로 데이터를 처리하는 것을 선호하는 개발자에게 새로운 interface를 통해 개발을 용이하게 할 수 있도록 도와주었다. (개발자는 X DEV API를 통해 데이터를 관리하고, 관리자 혹은 DBA는 해당 테이블에 대해 일반적인 SQL 을 통해 관리할 수 있다. (hybrid형태))

- X DEV API 를 이용하기 위해서는 전통적인 MySQL Client Tool 인 mysql CLI (command line interface) 를 이용하지 않고, MySQL Shell 을 이용해야 한다. 또한 MySQL 8.0 은 X DEV API를 위한 새로운 port 와 socket를 제공된다.

  ```sql
  mysql 8.0 [localhost] {msandbox} ((none)) > select @@global.port, @@global.mysqlx_port, @@global.socket,  @@global.mysqlx_socket\G
  *************************** 1. row ***************************
           @@global.port: 3306
    @@global.mysqlx_port: 33060
         @@global.socket: /tmp/mysql.sock
  @@global.mysqlx_socket: /tmp/mysqlx.sock
  1 row in set (0.00 sec)
  ```





- 아래의 그림은 mysqlsh 을 통해 Javascript 모드로 접속한 화면이다. 전통적인 mysql client tool 과 비슷하지만, 가독성이 높은 Prompt가 적용이 되었다.
  ![mysqlsh](/Users/kakaobank/Downloads/mysqlsh.jpeg)

- X DEV API 를 이용한 MySQL 사용은 아래와 같이 다양한 언어를 지원하며, 각각의 API를 통해 Collection 과 Document 를 저장할 수 있다. 해당 코드는 [MySQL Manual](https://dev.mysql.com/doc/x-devapi-userguide/en/collection-crud-function-overview.html) 에서 발췌해왔다.

  **MySQL Shell JavaScript Code**

  ```js
  // Create a new collection
  var myColl = db.createCollection('my_collection');

  // Insert a document
  myColl.add( {_id: '1', name: 'Sakila', age: 15 } ).execute();

  // Insert several documents at once
  myColl.add( [
  {_id: '5', name: 'Susanne', age: 24 },
  {_id: '6', name: 'User', age: 39 } ] ).execute();
  ```

  **MySQL Shell Python Code**

  ```python
  # Create a new collection
  myColl = db.create_collection('my_collection')

  # Insert a document
  myColl.add( {'_id': '1', 'name': 'Sakila', 'age': 15 } ).execute()

  # Insert several documents at once
  myColl.add( [
  {'_id': '5', 'name': 'Susanne', 'age': 24 },
  {'_id': '6', 'name': 'User', 'age': 39 } ] ).execute()
  ```

  **Node.js JavaScript Code**

  ```js
  // Create a new collection
  db.createCollection('myCollection').then(function (myColl) {
    return Promise.all([
      // Insert a document
      myColl
        .add({ name: 'Sakila', age: 15 })
        .execute(),
      // Insert several documents at once
      myColl
        .add([
          { name: 'Susanne', age: 24 },
          { name: 'User', age: 39 }
        ])
        .execute()
    ])
  });
  ```

  **C# Code**

  ```csharp
  // Assumptions: test schema assigned to db, my_collection collection not exists

  // Create a new collection
  var myColl = db.CreateCollection("my_collection");

  // Insert a document
  myColl.Add(new { name = "Sakila", age = 15 }).Execute();

  // Insert several documents at once
  myColl.Add(new[] {
  new { name = "Susanne", age = 24 },
  new { name = "User", age = 39 } }).Execute();
  ```

  **Python Code**

  ```python
  # Create a new collection
  my_coll = my_schema.create_collection('my_collection')

  # Insert a document
  my_coll.add({'name': 'Sakila', 'age': 15}).execute()

  # Insert several documents at once
  my_coll.add([
      {'name': 'Susanne', 'age': 24},
      {'name': 'User', 'age': 39}
  ]).execute()
  ```

  **Java Code**

  ```java
  // Create a new collection
  Collection coll = db.createCollection("payments");

  // Insert a document
  coll.add("{\"name\":\"Sakila\", \"age\":15}");

  // Insert several documents at once
  coll.add("{\"name\":\"Susanne\", \"age\":24}",
          "{\"name\":\"User\", \"age\":39}");
  ```

  **C++ Code**

  ```cpp
  // Create a new collection
  Collection coll = db.createCollection("payments");

  // Insert a document
  coll.add(R"({"name":"Sakila", "age":15})").execute();

  // Insert several documents at once
  std::list<DbDoc> docs = {
    DbDoc(R"({"name":"Susanne", "age":24})"),
    DbDoc(R"({"name":"User", "age":39})")
  };
  coll.add(docs).execute();
  ```



#
