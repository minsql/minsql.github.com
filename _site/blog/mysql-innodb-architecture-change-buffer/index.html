<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  

  
    
    <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>MySQL InnoDB architecture - change buffer | MINSQL</title>
<meta name="generator" content="Jekyll v3.5.2" />
<meta property="og:title" content="MySQL InnoDB architecture - change buffer" />
<meta name="author" content="MIN KIM" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="MySQL InnoDB architecture - change buffer" />
<meta property="og:description" content="MySQL InnoDB architecture - change buffer" />
<link rel="canonical" href="http://localhost:4000/blog/mysql-innodb-architecture-change-buffer/" />
<meta property="og:url" content="http://localhost:4000/blog/mysql-innodb-architecture-change-buffer/" />
<meta property="og:site_name" content="MINSQL" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-03-18T00:00:00+09:00" />
<script type="application/ld+json">
{"description":"MySQL InnoDB architecture - change buffer","author":{"@type":"Person","name":"MIN KIM"},"@type":"BlogPosting","url":"http://localhost:4000/blog/mysql-innodb-architecture-change-buffer/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/site-logo.png"},"name":"MIN KIM"},"headline":"MySQL InnoDB architecture - change buffer","dateModified":"2015-03-18T00:00:00+09:00","datePublished":"2015-03-18T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/mysql-innodb-architecture-change-buffer/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  

  <script>
    /* Cut the mustard */
    if ( 'querySelector' in document && 'addEventListener' in window ) {
      document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + 'js';
    }
  </script>

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="alternate" type="application/atom+xml" title="MINSQL" href="/feed.xml">
<!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

</head>

</head>

<body id="post">


  <div class="navigation-wrapper">
    <a href="#menu-toggle" id="menu-toggle">Menu</a>
    <nav id="primary-nav" class="site-nav animated drop">
      <ul><li><a href="/">Home</a></li><li><a href="/about/">About</a></li><li><a href="/blog/">Blog</a></li><li><a href="/tags/">Tags</a></li><li><a href="/search/">Search</a></li></ul>
    </nav>
  </div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <article class="entry">
    
  <!--  <img src="http://localhost:4000/images/mysql.png" class="entry-feature-image" alt="MySQL InnoDB architecture - change buffer" >-->
    <div class="entry-wrapper">
      <header class="entry-header">
        <ul class="entry-tags">
          <li><a href="http://localhost:4000/tags/#MySQL" title="Pages tagged MySQL">MySQL</a></li>
        </ul>
        
          <h1 class="entry-title">MySQL InnoDB architecture - change buffer</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="http://localhost:4000/images/fabmichaela-photo.jpg" class="bio-photo" alt="MIN KIM bio photo"/>
        
        <span class="author vcard">By <span class="fn">MIN KIM</span></span>
        <span class="entry-date date published"><time datetime="2015-03-18T00:00:00+09:00"><i class="fa fa-calendar-o"></i> March 18, 2015</time></span>
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        <div class="page-share">
  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fblog%2Fmysql-innodb-architecture-change-buffer%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--facebook btn--small"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i> <span>Share</span></a>
  <a href="https://twitter.com/intent/tweet?text=MySQL+InnoDB+architecture+-+change+buffer%20http%3A%2F%2Flocalhost%3A4000%2Fblog%2Fmysql-innodb-architecture-change-buffer%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--twitter btn--small"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i> <span>Tweet</span></a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fblog%2Fmysql-innodb-architecture-change-buffer%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--linkedin btn--small"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> <span>LinkedIn</span></a>
  <a href="https://reddit.com/submit?title=MySQL+InnoDB+architecture+-+change+buffer&url=http%3A%2F%2Flocalhost%3A4000%2Fblog%2Fmysql-innodb-architecture-change-buffer%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--reddit btn--small"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i> <span>Reddit</span></a>
</div>

        

          <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> My Table of Contents</h4></header>
              <ul class="toc__menu">
  <li><a href="#change-bufferinsert-buffer">change buffer(insert buffer)</a>
    <ul>
      <li><a href="#왜">왜?</a></li>
      <li><a href="#change-buffering-조건">change buffering 조건</a></li>
      <li><a href="#merge일어나는-경우">merge일어나는 경우</a></li>
      <li><a href="#change-buffer-status-확인">change buffer status 확인</a></li>
      <li><a href="#change-buffer-장점">change buffer 장점</a></li>
      <li><a href="#물리적-structure">물리적 structure</a></li>
      <li><a href="#관련-parameter">관련 parameter</a></li>
    </ul>
  </li>
</ul>
            </nav>
        <div class="google-ads" style="margin-top:40px; text-align:center;">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <!-- 160x600 ad -->
  <ins class="adsbygoogle"
       style="display:inline-block;width:160px;height:600px"
       data-ad-client="ca-pub-2669792816970567"
       data-ad-slot="6147132222"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div><!-- /.google-ads --><!-- /.google-ads -->
        
      </footer>
      <div class="entry-content">
        <h1 id="mysql-innodb-architecture---change-buffer">MySQL InnoDB architecture - change buffer</h1>

<h2 id="change-bufferinsert-buffer">change buffer(insert buffer)</h2>

<blockquote>
  <p>secondary index의 변경사항을 저장한다.</p>
</blockquote>

<h3 id="왜"><strong>왜?</strong></h3>

<ul>
  <li>DML에 의해서 secondary index의 컬럼 값이 변경되는 경우, secondary index의 leaf node를 update하려면, 디스크로부터 index page를 읽어서 변경해야하는데 이는 부수적으로 추가 IO가 필요한 작업이다. innodb는 인덱스 leaf node를 업데이트하지 않고 buffer만 해두는데 이때 change buffer(insert buffer)를 사용한다.</li>
  <li>이를 change buffering이라고 하며, 이는 insert buffering, delete buffering, purge buffering을 포함한다.</li>
</ul>

<h3 id="change-buffering-조건">change buffering 조건</h3>

<ul>
  <li><strong>secondary non-unique indexes</strong>에 대한 변경사항을 저장한다.
    <ul>
      <li>변경사항 merge가 일어나지 않으면 uniqueness를 체크 할수가 없지 않은가.</li>
    </ul>
  </li>
  <li>변경작업에 <strong>해당하는 page가 buffer pool에 존재하지 않을때</strong>만 change buffer에 변경을 저장한다.</li>
</ul>

<h3 id="merge일어나는-경우">merge일어나는 경우</h3>

<ul>
  <li><strong>해당 page가 다른 read operation에 의해서 buffer pool로 불려읽혀졌을 때</strong>
    <ul>
      <li>change buffer에 저장해둔 변경사항이 아직 반영되지 않은 채로 해당 page가 buffer pool에 로드된 경우, 먼저 change buffer에 cache되어있던 변경사항을 buffer pool에 불려진 page에 적용(merge)해야한다. 이후, 업데이트된 page는 flush mechanism에 따라 flush 되게 될 것이다.</li>
    </ul>
  </li>
  <li>background thread에 의한 주기적인 merge 작업
    <ul>
      <li><strong>system이 거의 idle일 때</strong>
        <ul>
          <li>DB를 안쓰고 IO작업도 안하고 있는데, high IO load를 목격했다면, 내부적으로 merge operation이 진행중인 것일 수 있다.</li>
        </ul>
      </li>
      <li><strong>slow shutdown 시</strong></li>
    </ul>
  </li>
</ul>

<h3 id="change-buffer-status-확인">change buffer status 확인</h3>

<ul>
  <li><code class="highlighter-rouge">SHOW ENGINE INNODB STATUSG</code>
    <ul>
      <li>INSERT BUFFER AND ADAPTIVE HASH INDEX항목에서 확인할 수 있다.</li>
    </ul>
  </li>
</ul>

<h3 id="change-buffer-장점">change buffer 장점</h3>

<ul>
  <li>매번 인덱스를 업데이트 하는 것보다 하나의 page내의 여러 update를 한번에 수행할 수 있으므로 효율적이다.</li>
  <li>disk reads, writes를 줄일 수 있어 특히 I/O bound workload가 많은 경우 유리하다.</li>
</ul>

<h3 id="물리적-structure">물리적 structure</h3>

<ul>
  <li>물리적으로, change buffer는 system tablespace에 위치한다. 그러므로 DB restart가 발생하더라도 buffered된 변경사항은 유지 보관된다.</li>
</ul>

<h3 id="관련-parameter">관련 parameter</h3>

<ul>
  <li><strong>innodb_change_buffering</strong>
    <ul>
      <li><em>all</em> : The default value: buffer inserts, delete-marking operations, and purges.</li>
      <li>none : Do not buffer any operations.</li>
      <li>inserts : Buffer insert operations.</li>
      <li>deletes : Buffer delete-marking operations.</li>
      <li>changes : Buffer both inserts and delete-marking.</li>
      <li>purges : Buffer the physical deletion operations that happen in the background.</li>
    </ul>
  </li>
  <li><strong>innodb_change_buffer_max_size</strong>
    <ul>
      <li>a percentage of the total size of the buffer pool</li>
    </ul>
  </li>
</ul>

        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://localhost:4000/blog/innodb_flush_log_at_trx_commit-%E1%84%80%E1%85%A2%E1%84%82%E1%85%A7%E1%86%B7%E1%84%83%E1%85%A9%E1%84%8B%E1%85%AA-%E1%84%90%E1%85%B2%E1%84%82%E1%85%B5%E1%86%BC-%E1%84%91%E1%85%A9%E1%84%8B%E1%85%B5%E1%86%AB%E1%84%90%E1%85%B3/" class="btn" title="innodb_flush_log_at_trx_commit 개념도와 튜닝 포인트">Previous</a>
      
      
        <a href="http://localhost:4000/blog/mysql-innodb-architecture-innodb-io-threads/" class="btn" title="MySQL InnoDB architecture – InnoDB I/O threads">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    <footer id="footer" class="site-footer">
  <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
<div class="copyright">
    
      <p>&copy; 2019 MINSQL. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/mmistakes/so-simple-theme" rel="nofollow">So Simple</a>.</p>
    
  </div>
</footer>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>


<!-- MathJax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


</body>
</html>
